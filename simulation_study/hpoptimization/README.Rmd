---
title: "Hyperparamter optimization"
output:   
  md_document:
    variant: markdown_github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
library(tidyverse)
library(ggplot2)
library(knitr)

php <- function(data){
  data %>%
    filter(param %in% numericalvars) %>%
    mutate(value = as.numeric(value)) %>% 
    ggplot(aes(x = value, y = "", color = group)) +
    geom_jitter(height = 0.2) +
    facet_wrap(vars(param), nrow = 2, scales = "free_x") +
    geom_vline(aes(xintercept = lb), color = "grey") +
    geom_vline(aes(xintercept = ub), color = "grey") 
}

php_c <- function(data){
  data %>%
    filter(param %in% categoricalvars) %>%
    mutate(value = as.factor(value)) %>% 
    ggplot(aes(x = value, color = group, fill = group, group = group)) +
    geom_bar(position="dodge") +
    facet_wrap(vars(param), nrow = 2, scales = "free_x") +
    labs(title = "(optimal) categorical hyperparameters", y = "", x = "Parameter values")
}
```

```{r, figure.heigth = 12}
hpsets <- readRDS("config/hpresults.RDS")
numericalvars <- c("balance_param.a", "balance_param.alpha", "balance_param.b", "model_param.alpha", "model_param.c", "model_param.class_weight", "feature_param.vector_size", "feature_param.epochs", "model_param.n_estimators")
categoricalvars <-c("feature_param.ngram_max", "feature_param.split_ta", "feature_param.use_keywords", "model_param.gamma", "feature_param.dbow_words", "feature_param.dm", "feature_param.dm_concat", "feature_param.min_count", "feature_param.window", "model_param.max_features") 
```


```{r}
library(tidyverse)
trials <- read_csv("trials/trials.csv")
```

```{r}
lossp <- function(trials, sort = TRUE){
  if(sort){
  p <-  trials %>%
    ggplot(aes(x = nrow(trials):1, y = loss))
  } else {
  p <- trials %>%
    ggplot(aes(x = trial, y = loss))
  }
  p + geom_line()
   
}
```

# Naive Bayes + TF-IDF 

## Loss plots
```{r}

```


## Hyperparameter values
```{r NB_TFIDF}
php(hpsets$nb_tfidf) + 
  labs(title = "Hyperparameters Naive Bayes + TF-IDF")

# plot feature_param.ngram_max
hpsets$nb_tfidf %>%
  php_c()

```


# SVM + TF-IDF 
```{r SVM_TFIDF, eval = FALSE}
hpsets$svm_tfidf %>%
  php() +
  labs(title = "Hyperparameters SVM + TF-IDF")

hpsets$svm_tfidf %>%
  php_c() 
```

```{r LR_TFIDF}
php(hpsets$lr_tfidf) + 
  labs(title = "Hyperparameters Logistic Regression + TF-IDF")

hpsets$lr_tfidf %>%
  php_c()
```

```{r LR_D2V, eval}
php(hpsets$lr_d2v) + 
  labs(title = "Hyperparameters Logistic Regression + Doc2Vec")

hpsets$lr_d2v %>%
  php_c()
```

```{r}
php(hpsets$rf_tfidf) + 
  labs(title = "Hyperparameters Random Forest + TF-IDF")

hpsets$rf_tfidf %>%
  php_c()
```


```{r}
php(hpsets$rf_d2v) + 
  labs(title = "Hyperparameters Random Forest + Doc2Vec")

hpsets$rf_d2v %>%
  php_c()
```

statistics for random forest + tf-idf
```{r}
hpsets$rf_tfidf %>%
   group_by(param, group) %>%
    summarise(variance = var(value), 
              sd = sd(value),
              min = min(value), 
              mean = mean(value),
              median = median(value),
              max = max(value)) %>%
  kable("markdown")
```

